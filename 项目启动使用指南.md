# 二手房可视化系统 - 项目启动使用指南

## 📋 目录

1. [系统要求](#系统要求)
2. [快速启动](#快速启动)
3. [详细启动步骤](#详细启动步骤)
4. [功能说明](#功能说明)
5. [常见问题](#常见问题)
6. [测试账号](#测试账号)

## 系统要求

### 必需软件

| 软件 | 版本要求 | 说明 |
|-----|---------|------|
| Python | 3.8+ | 后端开发语言 |
| Node.js | 14+ | 前端运行环境 |
| MySQL | 5.7+ / 8.0+ | 数据库 |
| npm | 6+ | 包管理工具 |

### 可选软件

| 软件 | 说明 |
|-----|------|
| Redis | Celery任务队列（可选） |

## 快速启动

### 方式1：一键启动脚本（推荐）

```bash
cd /Volumes/GT/dijangoMoonstar/python_bishe
./init_and_start.sh
```

**选择模式**：
- **模式1**：完整初始化（首次使用）
- **模式2**：仅启动服务（已完成初始化）
- **模式3**：重建数据库并启动
- **模式4**：退出

### 方式2：分步启动

#### 后端启动

```bash
# 1. 激活虚拟环境
cd /Volumes/GT/dijangoMoonstar/python_bishe
source venv/bin/activate

# 2. 启动Django
python manage.py runserver
```

#### 前端启动

```bash
# 新开一个终端
cd /Volumes/GT/dijangoMoonstar/python_bishe/front
npm run dev
```

## 详细启动步骤

### 首次使用（完整初始化）

#### 步骤1：准备环境

```bash
# 克隆或进入项目目录
cd /Volumes/GT/dijangoMoonstar/python_bishe

# 创建Python虚拟环境
python3 -m venv venv

# 激活虚拟环境
source venv/bin/activate

# 安装Python依赖
pip install -r requirements.txt
```

#### 步骤2：配置数据库

```bash
# 登录MySQL
mysql -u root -p

# 创建数据库
CREATE DATABASE realestate_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 退出MySQL
exit
```

**更新配置文件**：

编辑 `realestate_project/settings.py`，修改数据库密码：

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'realestate_db',
        'USER': 'root',
        'PASSWORD': '你的MySQL密码',  # 修改这里
        'HOST': 'localhost',
        'PORT': '3306',
    }
}
```

#### 步骤3：数据库迁移

```bash
# 生成迁移文件
python manage.py makemigrations

# 执行迁移
python manage.py migrate
```

#### 步骤4：创建管理员

```bash
python manage.py createsuperuser
# 按提示输入用户名、邮箱、密码
```

或使用Python脚本：

```bash
python manage.py shell
```

```python
from apps.users.models import User
User.objects.create_superuser('admin', 'admin@example.com', 'admin123', role='admin')
```

#### 步骤5：加载示例数据（可选）

```bash
# 如果有数据文件
python manage.py load_fixtures

# 或运行初始化脚本
python scripts/init_shanghai_data.py
```

#### 步骤6：安装前端依赖

```bash
cd front
npm install
cd ..
```

#### 步骤7：启动服务

```bash
# 使用一键启动脚本
./init_and_start.sh
# 选择模式 2（仅启动服务）
```

### 日常使用（已完成初始化）

```bash
# 直接运行启动脚本
./init_and_start.sh
# 选择模式 2
```

或手动启动：

```bash
# 终端1：后端
source venv/bin/activate
python manage.py runserver
# 启动任务执行者（Worker）
celery -A realestate_project worker -Q crawler -l info

# 启动定时调度器（Beat）
celery -A realestate_project beat -l info

# 终端2：前端
cd front
npm run dev
```



## 功能说明

### 访问地址

| 服务 | 地址 | 说明 |
|-----|------|------|
| 前端界面 | http://localhost:3000 | Vue前端应用 |
| 后端API | http://localhost:8000/api/ | Django REST API |
| 管理后台 | http://localhost:8000/admin/ | Django Admin |

### 主要功能

#### 1. 用户功能

**注册**：http://localhost:3000/register
- 支持普通用户和经纪人注册
- 必填：用户名、邮箱、手机号、密码

**登录**：http://localhost:3000/login
- 使用用户名和密码登录
- 自动获取JWT Token

**个人中心**：http://localhost:3000/profile
- 查看和编辑个人信息
- 修改密码

#### 2. 房源功能

**房源列表**：http://localhost:3000/houses
- 浏览所有在售房源
- 支持筛选和搜索
- 查看房源详情

**地图找房**：http://localhost:3000/map
- 地图上查看房源位置
- 点击标记查看详情

**我的房源**：http://localhost:3000/my-houses（经纪人）
- 发布新房源
- 管理已发布房源
- 上传房源图片
- **地图选点功能**：可视化选择房源位置

#### 3. 管理功能

**管理中心**：http://localhost:3000/admin（管理员）
- 用户管理
- 房源管理
- **区域管理**：CRUD操作
- 数据统计

#### 4. 数据分析

**数据分析**：http://localhost:3000/analysis
- 价格趋势分析
- 区域分布统计
- 可视化图表

### 核心特性

✅ **完整的用户系统**
- 注册、登录、权限管理
- 三种角色：普通用户、经纪人、管理员

✅ **房源管理**
- 发布、编辑、删除房源
- 图片上传管理
- 地图选点功能（新增）

✅ **区域管理**（新增）
- 查看、新增、编辑、删除区域
- 区域房源统计

✅ **价格自动计算**（新增）
- 输入单价和面积自动计算总价
- 输入总价和面积自动计算单价

✅ **地图可视化**
- 房源地图展示
- 地图选点功能

✅ **数据分析**
- 价格趋势图表
- 区域统计分析

## 常见问题

### Q1: 启动失败，提示端口被占用

**解决**：
```bash
# 查找占用端口的进程
lsof -i:8000  # 后端
lsof -i:3000  # 前端

# 杀死进程
kill -9 <PID>
```

### Q2: 数据库连接失败

**检查**：
1. MySQL是否运行：`mysql -u root -p`
2. 数据库是否存在：`SHOW DATABASES;`
3. 密码是否正确：检查 `settings.py`

**解决**：
```bash
# 重新创建数据库
mysql -u root -p
DROP DATABASE IF EXISTS realestate_db;
CREATE DATABASE realestate_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### Q3: 前端依赖安装失败

**解决**：
```bash
cd front
rm -rf node_modules package-lock.json
npm install
```

### Q4: 用户注册失败

**检查**：
1. 后端服务是否运行
2. 浏览器控制台是否有错误
3. 网络请求是否正确

**参考**：`用户注册问题排查.md`

### Q5: 房源在地图上不显示

**原因**：房源缺少经纬度坐标

**解决**：
1. 编辑房源
2. 点击"在地图上选择位置"
3. 选择位置并保存

**参考**：`地图选点功能说明.md`

### Q6: 虚拟环境激活失败

**解决**：
```bash
# 重新创建虚拟环境
rm -rf venv
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### Q7: Celery启动失败

**原因**：Redis未安装或未运行

**解决**：
```bash
# 安装Redis（macOS）
brew install redis

# 启动Redis
redis-server --daemonize yes

# 检查Redis
redis-cli ping
```

## 测试账号

系统预设了以下测试账号：

| 角色 | 用户名 | 密码 | 权限 |
|-----|--------|------|------|
| 超级管理员 | admin | admin123 | 所有权限 |
| 管理员 | admin2 | admin123 | 管理权限 |
| 经纪人 | agent1 | agent123 | 发布房源、管理区域 |
| 普通用户 | user1 | user123 | 浏览、收藏 |

## 停止服务

### 使用Ctrl+C

如果使用 `init_and_start.sh` 启动，按 `Ctrl+C` 会自动停止所有服务。

### 手动停止

```bash
# 停止Django
pkill -f "manage.py runserver"

# 停止前端
pkill -f "npm run dev"

# 停止Celery
pkill -f "celery worker"
pkill -f "celery beat"
```

## 项目结构

```
python_bishe/
├── apps/                    # Django应用
│   ├── users/              # 用户模块
│   ├── houses/             # 房源模块
│   ├── favorites/          # 收藏模块
│   ├── analysis/           # 分析模块
│   └── common/             # 公共模块
├── front/                   # Vue前端
│   ├── src/
│   │   ├── views/          # 页面组件
│   │   ├── components/     # 公共组件
│   │   ├── api/            # API接口
│   │   └── router/         # 路由配置
│   └── package.json
├── realestate_project/      # Django项目配置
├── logs/                    # 日志文件
├── media/                   # 媒体文件
├── static/                  # 静态文件
├── data_fixtures/           # 数据文件
├── requirements.txt         # Python依赖
├── init_and_start.sh       # 一键启动脚本
└── manage.py               # Django管理脚本
```

## 开发文档

- `API_DOCUMENTATION.md` - API接口文档
- `QUICKSTART.md` - 快速开始指南
- `FRONTEND_GUIDE.md` - 前端开发指南
- `地图选点功能说明.md` - 地图选点功能详解
- `用户注册问题排查.md` - 注册问题排查
- `问题修复记录.md` - 已修复问题记录

## 技术栈

### 后端
- Django 4.2
- Django REST Framework
- MySQL 8.0
- Celery + Redis
- JWT认证

### 前端
- Vue 3
- Element Plus
- Leaflet（地图）
- ECharts（图表）
- Axios

## 联系支持

如果遇到问题：
1. 查看相关文档
2. 检查日志文件（`logs/`目录）
3. 查看浏览器控制台错误
4. 参考常见问题解答

---

**祝您使用愉快！** 🎉

